<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sSQL">
	<select id="qListCnt" resultType="int">
		SELECT
		    COUNT(*)
		FROM
		    quest
	</select>
	
	<select id="ingCnt" resultType="int">
		SELECT
			COUNT(*)
		FROM
			topic
		WHERE
			sysdate BETWEEN startdate AND enddate
	</select>
	
	<!-- 설문 리스트 조회 질의명령 -->
	<select id="surveyList" resultType="sVO">
		SELECT
		    tpno, title, 
		    CASE WHEN (sysdate BETWEEN startdate AND enddate) THEN 'OK'
		    ELSE 'NO'
		    END as ing
		FROM
		    topic
		ORDER BY
			startdate DESC, enddate
	</select>
	
	<!-- 설문주제번호로 설문 문항 등록여부 조회 질의명령 -->
	<select id="getSurveyCnt" resultType="string" parameterType="int">
		SELECT
		    DECODE(COUNT(*), 0, 'NO', 'YES')
		FROM
		    survey
		WHERE
		    stno = #{tpno}
	</select>
	
	<insert id="addQuest" parameterType="sVO">
		<selectKey keyProperty="qno" resultType="int" order="BEFORE">
			SELECT NVL(MAX(qno) + 1, 1001) FROM quest
		</selectKey>
		INSERT INTO
			quest
		VALUES(
			#{qno}, #{body}, 
		<if test="qupno eq 0">null</if>
		<if test="qupno neq 0">#{qupno}</if>
		)
	</insert>
	
	<!-- 설문조사 문항 등록 질의명령 -->
	<insert id="setSurvey" parameterType="sVO">
		INSERT INTO
		    survey
		VALUES(
		    (SELECT NVL(MAX(svno) + 1, 1001) FROM survey),
		    #{tpno}, #{qno}
		)
	</insert>
</mapper>